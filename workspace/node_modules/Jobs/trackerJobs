else if(post[job]==getSharedTrackers)
                {
                    var sharedTrackers=[];
                    MongoClient.connect(url,function(err,db)
                    {
                        var list=post["list"];
                        async.each(list,function(name,callback){
                            var sharedTracker=name;
                            var finder={};
                            finder[userName]=name[userName];
                            if(typeof finder[userName] != 'undefined'){
    
                                var cursor=db.collection('user').find(finder);
                                cursor.nextObject(function fn(err, user) {
                                    if (err || !user){
                                        callback();
                                        return;
                                    } 
                                    setImmediate(fnAction, user, function() {
                                        cursor.nextObject(fn);
                                    });
                                });
                                function fnAction(user, callback) {
                                    // Here you can do whatever you want to do with your item.
                                    if(typeof user!= 'undefined'&& user!=null && user['trackers']!= 'undefined'){
                                        var trackers=user['trackers'];
                                        if(trackers!=null)
                                        {
                                            for(var j=0;j<trackers.length;j++)
                                            {
                                                var tracker=trackers[j];
                                                if(tracker['UUID']==sharedTracker['UUID'])
                                                {
                                                    sharedTrackers.push(JSON.stringify(tracker));
                                                }
                                            }
                                        }
                                    }
                                    return callback();
                                }
                            }
                        },function(err){
                            if(err){
                                response.writeHeader(200, 
                                {
                                    "Content-Type": "text/plain",
                                    //'Content-Length': object.length
                                });
                                response.write("failed");
                                //db.close();
                                return err;
                            }
                            response.writeHeader(200, 
                            {
                                "Content-Type": "text/plain",
                                //'Content-Length': object.length
                            });
                           
                            response.write(JSON.stringify(sharedTrackers))
                            db.close();
                            response.end();
                        });
                      
                    });
                    
                    

else if(post[job]=="save_tracker")
                {
                    MongoClient.connect(url,function(err,db){
                        
                        var finder={};
                        finder[userName]=post[userName];
                        var newTracker = post['Tracker'];
                        var cursor=db.collection('user').find(finder);
                        cursor.each(function(err, user) 
                        {
                            assert.equal(err, null);
                            if (user != null) 
                            {
                                var trackers=user['trackers'];
                                if(trackers!=null)
                                {
                                    var trackerCheck=true;
                                    for(var i=0;i<trackers.length;i++)
                                    {
                                        var tracker=trackers[i];
                                        if(tracker['startDate']==newTracker['startDate'])
                                        {
                                            trackers[i]=newTracker;
                                            user['trackers']=trackers;
                                            trackerCheck=false;
                                        }
                                    }
                                    if(trackerCheck){
                                        trackers.push(newTracker);
                                        user['trackers']=trackers;
                                    }
                                     db.collection('user').save(user, 
                                     {
                                        w: 1
                                     }, function(err, result) 
                                     {
    
                                        db.close();
                                     });
                                    
                                }
                            }
                            else 
                            {
                                object="";
                            }
                            if (!end) 
                            {
                                response.writeHeader(200, 
                                {
                                    "Content-Type": "text/plain",
                                    //'Content-Length': object.length
                                });
                                response.write(object);
                                response.end();
                                end = true;
                            }
    
                        });
                    });
                }
                

else if(post[job]=='deleteTracker'){
                    MongoClient.connect(url,function(err,db)
                    {
                        var finder={};
                        finder[userName]=post[userName];
                        var cursor=db.collection('user').find(finder);
                        cursor.each(function(err,user){
                            if(user!=null)
                            {
                                var trackers=user['trackers'];
                                for(var i=0;i<trackers.length;i++)
                                {
                                    if(trackers[i]['UUID']===post['UUID'])
                                    {
                                        trackers.splice(i);
                                    }
                                }
                                user['trackers']=trackers;
                                db.collection('user').save(user,{
                                    w:1
                                },function(err, result){
                                    db.close();
                                    response.write("done");
                                    response.end();
                                });
                            }
                            else{
                               
    
                            }
                        });
                        
                    });
                }
                
                
else if (post[job]=="ChangeTrackerSharingStatus") {
                    MongoClient.connect(url, function(err, db) {
                        assert.equal(null, err);

                        var object;
                        var finder={};
                        
                        finder[userName]=post[GLOBAL.userName];
                        var test=post[sharedTrackers];
                        var cursor = db.collection('user').find(finder);
                        cursor.each(function(err, user) {
                            //assert.equal(err, null);
                            if (user != null) 
                            {
                                var sharedTrackers=user[GLOBAL.sharedTrackers];
                                for(var i=0; i < sharedTrackers.length;i++)
                                {
                                    if(sharedTrackers[i]['UUID']===post[GLOBAL.sharedTrackers]['UUID'])
                                    {
                                        sharedTrackers[i]["SharedTrackerStatus"]==post[GLOBAL.sharedTrackers]["SharedTrackerStatus"];
                                    }
                                }
                                user[GLOBAL.sharedTrackers]=sharedTrackers;
                                db.collection('user').save(user,{
                                    w:1
                                },function(err, result){
                                    //db.close();
                                    var cursor2=db.collection('user').find(finder);
                                    cursor2.each(function(err,user2){
                                    });
                                    response.write("done");
                                    response.end();
                                });
                                
                            }
                            else
                            {
                                //object = JSON.stringify(jotain);
                            }
    
                        });
                      
                    }); 

                }
                


 else if(post[job]==="AddSharedTracker"){
                    MongoClient.connect(url,function(err,db)
                    {
                        assert.equal(err,null);
                        var finder={};
                        finder[userName]=post[GLOBAL.userName];
                        var cursor=db.collection('user').find(finder);
                        cursor.each(function(err,user){
                            if(user!=null){
                                if(typeof  user[GLOBAL.sharedTrackers]=='undefined'){
                                    user[GLOBAL.sharedTrackers]=[];
                                }
                                var found=false;
                                for(var i=0;i<user[GLOBAL.sharedTrackers].length&&!found;i++){
                                    if(user[GLOBAL.sharedTrackers][i]["UUID"]==post[GLOBAL.sharedTrackers]["UUID"]){
                                        found=true;
                                    }
                                }
                                if(!found){
                                     user[GLOBAL.sharedTrackers].push(post[GLOBAL.sharedTrackers]);
                                    db.collection('user').save(user,{
                                        w:1
                                    },function(err,result){
                                        db.close();
                                        response.write("done");
                                        response.end();
                                    });
                                }else{
                                    db.close();
                                    response.write("done");
                                    response.end();
                                }
                               
                            }
                        });
                    });
                }
