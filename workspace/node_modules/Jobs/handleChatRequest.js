// By jarij and attey 17.3.17
const assert = require("assert");

function handleChatRequest(db, post, callback)
{
    
    var finder={};
    //var response = post['chatRequestResponse']['response'];
    finder['customer']=post['chatRequestResponse']['customer'];
    db.collection('chatRequestResponses').findOne(finder, function(err, result)
    {
        assert.equal(err, null);
        if(result==null)
        {
            result={};
            result['customer']=post['chatRequestResponse']['customer'];
            result['chatRequestResponses']=[];
        }
        result['chatRequestResponses'].push(post['chatRequestResponse']);
        db.collection('chatRequestResponses').save(result,{w:0},function(err,result)
        {
            assert.equal(err,null);
            db.close();
            return callback("Response saved");
        });
        
    });
}

module.exports = handleChatRequest;