const assert = require("assert");
function getChatRequests(db, post, callback)
{
    var finder={};
    
    finder['coach']=post[GLOBAL.userName];
    db.collection('chatRequests').findOne(finder,function(err,result)
    {
        assert.equal(err,null);
        if(result==null)
        {
            db.close();
            return callback("no requests found "+post[GLOBAL.userName]);
        }
        else if(typeof result['chatRequests']=='undefined')
        {
            db.close();
            return callback("no requests found "+post[GLOBAL.userName]);
        }
        else
        {
            db.close();
            return callback(JSON.stringify(result['chatRequests']));
        }
    });
    /*
    var requestArray=[];
    var cursor = db.collection('chatRequests').find(finder);
    cursor.each(function(err, doc) 
    {
        assert.equal(err, null);
        if (doc != null) 
        {
            requestArray.push(JSON.stringify(doc));
        }
        else
        {
            var text=JSON.stringify(requestArray);
            db.close();
            if(typeof text != 'undefined')
            {
                return callback(text);
            }
            else
            {
                return callback("could get chat requests");
            }
        }
            
    });
    */
}

module.exports = getChatRequests;