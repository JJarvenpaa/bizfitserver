//By jarij,
//last time modificated: 8.3.17
const assert = require("assert");
function getMessageOutgoing(db, post, callback)
{
    var object;
    var array=[];
    //TODO haku toistenp√§in
    //var finder={function() { return (this.resipient == post['owner'] && this.sender==post['other'] ) } };
    //var finder={'&and':[{'resipient':{'&eq' :post['owner']}},{'sender':{'&eq' :post['other']}}]};
    var finder = {'resipient':post["other"]};
    var cursor = db.collection('message').find(finder);
    cursor.each(function(err, doc) 
    {
        assert.equal(err, null);
        if (doc != null) 
        {
            //var jotain={'user':doc};
            if(post["creationTime"]<doc["creationTime"] && post["owner"] == doc["sender"]){
                array.push(JSON.stringify(doc));
            }else{
                //array.push(JSON.stringify(doc)); // for testing only
            }
        }
        else 
        {                        
            var text=JSON.stringify(array);
            db.close();     
            if(typeof text != 'undefined')
            {
                return callback(text);
            }
            else
            {
                return callback("Couldn't get outgoing messages");
            }
        };
                   
    });
}

module.exports = getMessageOutgoing;
                        