const assert = require("assert");
function saveConversation(db, post, callback)
{

    var newConversation=post['conversation'];
    var finder={};
    finder[GLOBAL.userName]=newConversation['owner'];
    db.collection('user').findOne(finder, function(err, user)
    {
        assert.equal(err, null);
        if (user != null) 
        {
            var conversations=user['conversations'];
            var conversation;
            if(conversations!=null)
            {
                for(var i=0;i<conversations.length;i++)
                {
                    conversation=conversations[i];
                    if(conversation['other']==newConversation['other'])
                    {
                        conversations[i]=newConversation;
                        user['conversations']=conversations;
                    }
                }
                db.collection('user').save(user, 
                {
                    w:1 
            
                }, function(err, result) 
                {
                    assert.equal(err, null)
                    db.close();
                });
    
            }
            if(typeof conversations !="undefined")
            {
                return callback("Conversation saved");
            }
            
        }
        else 
        {
            return callback("Couldn't save conversation");    
        }
    });
}

module.exports = saveConversation;